{
  "version": 3,
  "sources": ["src/main.js"],
  "sourcesContent": ["const { Plugin, PluginSettingTab, Setting } = require('obsidian');\n\nconst DEFAULT_SETTINGS = {\n  hideCompleted: false\n};\n\nmodule.exports = class TodoMoverPlugin extends Plugin {\n  async onload() {\n    // load plugin data: { settings, hidden }\n    this.data = await this.loadData() || {};\n    this.data.settings = Object.assign({}, DEFAULT_SETTINGS, this.data.settings || {});\n    this.data.hidden = this.data.hidden || {};\n    this.settings = this.data.settings;\n    this.processing = new Set();\n\n    this.addSettingTab(new TodoMoverSettingTab(this.app, this));\n\n    this.registerEvent(this.app.vault.on('modify', (file) => this.onFileModify(file)));\n\n    this.addCommand({\n      id: 'checklist-mover:move-completed-items',\n      name: 'Checklist Mover: Move completed items to bottom (current file)',\n      callback: async () => {\n        const file = this.app.workspace.getActiveFile();\n        if (file) await this.processFile(file);\n      }\n    });\n\n    this.addCommand({\n      id: 'checklist-mover:toggle-hide',\n      name: 'Checklist Mover: Toggle hide completed',\n      callback: async () => {\n        this.settings.hideCompleted = !this.settings.hideCompleted;\n        this.data.settings = this.settings;\n        await this.saveData(this.data);\n        const file = this.app.workspace.getActiveFile();\n        if (file) await this.processFile(file);\n      }\n    });\n  }\n\n  onunload() {}\n\n  async onFileModify(file) {\n    try {\n      if (!file || file.extension !== 'md') return;\n      if (this.processing.has(file.path)) return;\n      await this.processFile(file);\n    } catch (e) {\n      console.error('TodoMover error', e);\n    }\n  }\n\n  async processFile(file) {\n    this.processing.add(file.path);\n    try {\n      const content = await this.app.vault.read(file);\n      const newContent = this.reorderContent(content, file.path);\n      if (newContent !== content) {\n        await this.app.vault.modify(file, newContent);\n      }\n    } finally {\n      this.processing.delete(file.path);\n    }\n  }\n\n  reorderContent(content, filePath) {\n    const origLines = content.split(/\\r?\\n/);\n    const kept = new Array(origLines.length).fill(false);\n    const resultLines = [];\n    const MARKER_RE = /^\\s*<!--\\s*TODO-MOVER:\\s*(hide|move)\\s*-->\\s*$/i;\n\n    // ensure hidden storage exists\n    this.data.hidden = this.data.hidden || {};\n    const hiddenForFile = this.data.hidden[filePath] || [];\n\n    let i = 0;\n    while (i < origLines.length) {\n      const startMatch = origLines[i].match(/^(\\s*[-*+]\\s\\[( |x|X)\\]\\s)(.*)$/);\n      if (startMatch) {\n        const start = i;\n        const blockIndices = [];\n        while (i < origLines.length) {\n          const m = origLines[i].match(/^(\\s*[-*+]\\s\\[( |x|X)\\]\\s)(.*)$/);\n          if (m) {\n            blockIndices.push(i);\n            i++;\n            continue;\n          }\n          break;\n        }\n\n        // detect per-list override marker on the line immediately above the list\n        let override = null;\n        if (start > 0) {\n          const prev = origLines[start - 1].match(MARKER_RE);\n          if (prev) override = prev[1].toLowerCase();\n        }\n\n        const hideForThisBlock = override === 'hide' ? true : (override === 'move' ? false : this.settings.hideCompleted);\n\n        const unchecked = [];\n        const checkedEntries = [];\n\n        for (const idx of blockIndices) {\n          const m = origLines[idx].match(/^(\\s*[-*+]\\s\\[( |x|X)\\]\\s)(.*)$/);\n          const raw = origLines[idx];\n          const checked = m[2].toLowerCase() === 'x';\n          if (checked && hideForThisBlock) {\n            checkedEntries.push({ index: idx, text: raw });\n            kept[idx] = false;\n          } else if (checked && !hideForThisBlock) {\n            // will be moved to bottom of block later (keep order)\n            checkedEntries.push({ index: idx, text: raw });\n            // mark as kept so non-removed\n            kept[idx] = true;\n          } else {\n            unchecked.push(raw);\n            kept[idx] = true;\n          }\n        }\n\n        if (hideForThisBlock) {\n          // remove checked items (they're recorded in checkedEntries)\n          resultLines.push(...unchecked);\n          // append recorded hidden entries to stored list\n          if (checkedEntries.length > 0) {\n            // merge into existing hidden list for this file\n            this.data.hidden[filePath] = (this.data.hidden[filePath] || []).concat(checkedEntries);\n          }\n        } else {\n          // move mode: unchecked then checked\n          resultLines.push(...unchecked);\n          resultLines.push(...checkedEntries.map(e => e.text));\n        }\n\n      } else {\n        // non-list line: keep as-is\n        resultLines.push(origLines[i]);\n        kept[i] = true;\n        i++;\n      }\n    }\n\n    // If hideCompleted is false, and we have stored hidden items for this file, reinsert them at their original positions\n    if (!this.settings.hideCompleted && filePath && this.data.hidden[filePath] && this.data.hidden[filePath].length) {\n      // Ensure entries are sorted by original index\n      const entries = this.data.hidden[filePath].slice().sort((a, b) => a.index - b.index);\n\n      // For each entry compute insertion position based on how many kept lines exist before its original index\n      for (const entry of entries) {\n        const insertPos = kept.slice(0, entry.index).filter(Boolean).length;\n        // clamp insert position\n        const pos = Math.min(Math.max(0, insertPos), resultLines.length);\n        resultLines.splice(pos, 0, entry.text);\n        // mark as kept (not strictly necessary now)\n      }\n\n      // clear stored hidden entries for this file\n      delete this.data.hidden[filePath];\n    }\n\n    // persist any changes to hidden storage\n    this.saveData(this.data);\n\n    return resultLines.join('\\n');\n  }\n\n  async saveSettings() {\n    this.data.settings = this.settings;\n    await this.saveData(this.data);\n  }\n}\n\nclass TodoMoverSettingTab extends PluginSettingTab {\n  constructor(app, plugin) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n\n  display() {\n    const { containerEl } = this;\n    containerEl.empty();\n    containerEl.createEl('h2', { text: 'Checklist Mover settings' });\n\n    new Setting(containerEl)\n      .setName('Hide completed tasks')\n      .setDesc('When enabled, completed tasks are removed instead of moved to the bottom.')\n      .addToggle(toggle => toggle\n        .setValue(this.plugin.settings.hideCompleted)\n        .onChange(async (value) => {\n          this.plugin.settings.hideCompleted = value;\n          await this.plugin.saveSettings();\n        }));\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
